version: '3'
services:
 proxy:
  container_name: "proxy"
  build: proxy/
  volumes:
   - "./proxy/nginx.conf:/etc/nginx/conf.d/default.conf"
  ports:
   - "80:80"
  environment:
   - NGINX_HOST=app.isnogood.ru
   - NGINX_PROXY=http://dockerapp:9090
  links:
   - dockerapp       
 dockerapp:
  container_name: "app"
  image: "bashmeunix/book:latest"
  ports:
    - "127.0.0.1:5000:5000"
    - "127.0.0.1:9090:9090"
  build: .
  ports:
   - "127.0.0.1:5000:5000"
   - "127.0.0.1:9090:9090"
  environment:
   - ENV=PROD
  volumes:
   - "./app:/app"
   - "./entry-point.sh:/entry-point.sh"
  links:
   - resolver
   - redis
 resolver:
  container_name: "resolver"
  image: "bashmeunix/ptr:0.1"
 redis:
  container_name: "redis"
  image: "redis:latest"
